<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ecommind Agency â€” DÃ©mo IA vocale</title>
  <meta name="description" content="DÃ©mo IA vocale Ecommind â€” multilingue, persuasive, conÃ§ue pour convertir sans friction.">
  <style>
    :root{
      --gold:#C9A55E; --blue:#00BFFF; --black:#000000; --bg2:#0D1B2A; --white:#FFFFFF; --muted:#98A2B3;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--black);color:var(--white);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    /* Header */
    .hdr{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;align-items:center;gap:12px}
    .dot{width:12px;height:12px;border-radius:50%;background:var(--gold);box-shadow:0 0 16px var(--gold)}
    .logo{font-weight:800;letter-spacing:.3px}
    .tagline{opacity:.85;font-size:12px}
    .hdr-cta{display:flex;gap:10px;flex-wrap:wrap}
    .btn{border:1px solid rgba(255,255,255,.14);background:transparent;color:#fff;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-1px);border-color:var(--blue);box-shadow:0 0 0 4px rgba(0,191,255,.08)}
    .btn.gold{border-color:var(--gold)}
    /* Hero */
    .hero{display:grid;gap:14px;padding:24px;border:1px solid rgba(255,255,255,.08);border-radius:20px;background:var(--bg2)}
    .h1{font-size:28px;margin:0;line-height:1.2}
    .sub{opacity:.85;margin:0}
    .kpis{display:flex;gap:10px;flex-wrap:wrap}
    .pill{border:1px solid rgba(255,255,255,.16);padding:6px 10px;border-radius:999px;font-size:12px;opacity:.95}
    .badge{border:1px dashed rgba(255,255,255,.2);padding:6px 10px;border-radius:10px;font-size:12px}
    /* Demo panel */
    .panel{display:grid;gap:12px;margin-top:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .inp{flex:1;min-width:240px;background:transparent;border:1px solid rgba(255,255,255,.14);color:#fff;padding:12px 14px;border-radius:12px;outline:none}
    .rec{border-color:rgba(201,165,94,.6)}
    .stop{border-color:rgba(255,255,255,.35)}
    .status{font-size:12px;opacity:.8}
    .resp{white-space:pre-wrap;line-height:1.6;background:transparent;border:1px solid rgba(255,255,255,.14);border-radius:14px;padding:14px;min-height:84px}
    .meta{display:flex;gap:10px;flex-wrap:wrap}
    audio{width:100%}
    /* Value & trust */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:18px}
    .card{border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:14px;background:#000}
    .card h3{margin:0 0 6px 0;font-size:16px}
    .muted{color:var(--muted);font-size:14px}
    .price{font-weight:800}
    /* Footer */
    .ftr{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;align-items:center;margin-top:24px;padding-top:16px;border-top:1px solid rgba(255,255,255,.12);font-size:12px;color:var(--muted)}
    .ftr .mini a{color:var(--blue)}
    /* Micro animations */
    .pulse{box-shadow:0 0 0 0 rgba(201,165,94,.6);animation:pulse 2s ease-out infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(201,165,94,.45)}70%{box-shadow:0 0 0 12px rgba(201,165,94,0)}100%{box-shadow:0 0 0 0 rgba(201,165,94,0)}}
    /* Responsive */
    @media (max-width:880px){ .grid{grid-template-columns:1fr 1fr} }
    @media (max-width:620px){ .grid{grid-template-columns:1fr} .h1{font-size:22px} }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <header class="hdr">
      <div class="brand">
        <div class="dot pulse" aria-hidden="true"></div>
        <div>
          <div class="logo">Ecommind Agency</div>
          <div class="tagline">Captiver. DÃ©clencher. Convertir.</div>
        </div>
      </div>
      <div class="hdr-cta">
        <a class="btn" href="https://ecommind-agency.com/pages/packs">Voir les packs</a>
        <a class="btn gold" href="https://ecommind-agency.com/pages/contact-ecommind">Parler Ã  un expert</a>
      </div>
    </header>

    <!-- HERO / DEMO -->
    <section class="hero" aria-label="DÃ©mo IA vocale">
      <h1 class="h1">Votre prospect parle. <span style="color:var(--gold)">Lâ€™IA rÃ©pond</span> dans sa langue. <span style="color:var(--blue)">Et le convainc</span>.</h1>
      <p class="sub">DÃ©mo multilingue en temps rÃ©el â€” pensÃ©e pour lever les objections et amener la dÃ©cision sans friction.</p>

      <div class="kpis">
        <div class="pill">Auto-dÃ©tection de langue</div>
        <div class="pill">Voix native ElevenLabs</div>
        <div class="pill">RÃ©ponses concises & orientÃ©es achat</div>
      </div>

      <!-- CONTROLS -->
      <div class="panel">
        <div class="row">
          <button id="recBtn" class="btn rec">ðŸŽ¤ Enregistrer</button>
          <button id="stopBtn" class="btn stop" disabled>â–  Stop</button>
          <input id="textInput" class="inp" placeholder="â€¦ou Ã©crivez une question (FR / EN / AR / ES)"/>
          <button id="sendBtn" class="btn">Envoyer</button>
        </div>
        <div class="meta">
          <div class="badge">Langue dÃ©tectÃ©e : <b id="lang">â€”</b></div>
          <div class="badge">Statut : <span id="status">PrÃªt</span></div>
        </div>
        <div class="resp" id="output" aria-live="polite">La rÃ©ponse sâ€™affichera iciâ€¦</div>
        <audio id="player" controls aria-label="Lecture de la rÃ©ponse vocale"></audio>
      </div>

      <!-- VALUE/PROOF -->
      <div class="grid" aria-label="Arguments clÃ©s">
        <div class="card">
          <h3>ClartÃ© qui rassure</h3>
          <div class="muted">Messages courts, ton premium. Lâ€™IA Ã©limine le bruit, garde lâ€™essentiel, parle comme un conseiller.</div>
        </div>
        <div class="card">
          <h3>Langue & contexte</h3>
          <div class="muted">DÃ©tection automatique (FR/EN/AR/ES/â€¦). RÃ©ponse et voix natives pour une comprÃ©hension immÃ©diate.</div>
        </div>
        <div class="card">
          <h3>PrÃªt Ã  closer</h3>
          <div class="muted">ScÃ©nario maÃ®trisÃ© : objection â†’ bÃ©nÃ©fice â†’ next-step. CTA directs vers RDV ou achat.</div>
        </div>
      </div>

      <!-- OFFER -->
      <div class="card" style="margin-top:12px">
        <h3 style="margin:0 0 8px 0;">Offre de dÃ©ploiement</h3>
        <div class="muted">Mise en place initiale <span class="price" style="color:var(--gold)">2490â‚¬</span> Â· Accompagnement <span class="price" style="color:var(--blue)">490â‚¬/mois</span> Ã  partir du 3áµ‰ mois.</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <a class="btn gold" href="https://ecommind-agency.com/pages/offre-royale-buisness">Pack Royal</a>
          <a class="btn" href="https://ecommind-agency.com/pages/offre-elegance">Pack Ã‰lÃ©gance</a>
          <a class="btn" href="https://ecommind-agency.com/pages/offre-buisness">Pack Business</a>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="ftr">
      <div>Â© 2025 Ecommind Agency. Tous droits rÃ©servÃ©s.</div>
      <div class="mini">
        <a href="https://ecommind-agency.com/pages/a-propos">Ã€ propos</a> Â·
        <a href="https://ecommind-agency.com/pages/contact-ecommind">Contact</a>
      </div>
    </footer>
  </div>

  <script>
    const apiBase = ""; // mÃªme origine (servi par Express)

    const recBtn = document.getElementById("recBtn");
    const stopBtn = document.getElementById("stopBtn");
    const sendBtn = document.getElementById("sendBtn");
    const textInput = document.getElementById("textInput");
    const statusEl = document.getElementById("status");
    const langEl = document.getElementById("lang");
    const outEl = document.getElementById("output");
    const player = document.getElementById("player");

    let mediaRecorder, chunks = [];
    let lastLang = null;

    const setStatus = (t)=> statusEl.textContent = t;
    const setLang = (t)=> langEl.textContent = t || "â€”";

    // --- AUDIO FLOW (Whisper -> Chat -> TTS) ---
    recBtn.onclick = async () => {
      try{
        chunks = [];
        const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = onStopRecord;
        mediaRecorder.start();
        recBtn.disabled = true; stopBtn.disabled = false;
        setStatus("Enregistrementâ€¦");
      }catch(e){
        setStatus("Micro refusÃ©");
        console.error(e);
      }
    };

    stopBtn.onclick = () => {
      if(mediaRecorder && mediaRecorder.state !== "inactive") mediaRecorder.stop();
      recBtn.disabled = false; stopBtn.disabled = true;
      setStatus("Traitement audioâ€¦");
    };

    async function onStopRecord(){
      const blob = new Blob(chunks, { type: "audio/webm" });
      const form = new FormData();
      form.append("audio", blob, "audio.webm");
      const r = await fetch(`${apiBase}/api/stt`, { method:"POST", body: form });
      const data = await r.json();
      if(data.error){ setStatus("Erreur STT"); console.error(data.error); return; }
      const { text, language } = data;
      lastLang = language || "en";
      setLang(lastLang);
      setStatus("GÃ©nÃ©rationâ€¦");
      await handleChatAndTTS(text);
    }

    // --- TEXT FLOW (LangDetect -> Chat -> TTS) ---
    sendBtn.onclick = async () => {
      const userText = (textInput.value || "").trim();
      if(!userText) return;

      setStatus("DÃ©tection de langueâ€¦");
      let detLang = "en";
      try{
        const r = await fetch(`${apiBase}/api/lang-detect`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ text: userText })
        });
        const d = await r.json();
        detLang = d.lang || "en";
      }catch(e){
        // fallback si le service est indispo
        detLang = quickFallback(userText);
      }

      lastLang = detLang;
      setLang(lastLang);
      setStatus("GÃ©nÃ©rationâ€¦");
      await handleChatAndTTS(userText);
    };

    // --- COMMON: Chat + TTS ---
    async function handleChatAndTTS(userText){
      // 1) Chat
      const r = await fetch(`${apiBase}/api/chat`, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ userText, langHint:lastLang })
      });
      const data = await r.json();
      if(data.error){ setStatus("Erreur LLM"); console.error(data.error); return; }
      outEl.textContent = data.reply || "";

      // 2) TTS
      setStatus("SynthÃ¨se vocaleâ€¦");
      const r2 = await fetch(`${apiBase}/api/tts`, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ text:data.reply, lang:lastLang })
      });
      if(!r2.ok){ setStatus("Erreur TTS"); console.error(await r2.text()); return; }
      const buf = await r2.arrayBuffer();
      const blob = new Blob([buf], { type: "audio/mpeg" });
      player.src = URL.createObjectURL(blob);
      player.play().catch(()=>{});
      setStatus("PrÃªt");
    }

    // Fallback ultra-simple si /api/lang-detect est KO
    function quickFallback(t){
      if (/[Ø§Ø£Ø¥Ø¢Ø¡-ÙŠ]/.test(t)) return "ar";
      if (/[Ã Ã¢Ã§Ã©Ã¨ÃªÃ«Ã®Ã¯Ã´Ã»Ã¹Ã¼Ã¿Å“]/i.test(t)) return "fr";
      if (/[Ã±Ã¡Ã©Ã­Ã³ÃºÃ¼]/i.test(t)) return "es";
      if (/[Ã¤Ã¶Ã¼ÃŸ]/i.test(t)) return "de";
      if (/[Ã Ã¨Ã©Ã¬Ã­Ã®Ã²Ã³Ã¹]/i.test(t)) return "it";
      return "en";
    }
  </script>
</body>
</html>
